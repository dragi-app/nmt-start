<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Коли починати готуватись до НМТ – Драгі</title>
    <style>
      /*
        Цей файл створює покроковий інструмент для визначення ідеального часу
        старту підготовки до НМТ. Дизайн натхненний промо‑сторінками
        застосунку DRAGI: м’які градієнти, чисті карти й мінімалістичні
        кнопки. Окремі екрани покращують фокус користувача.
      */
      :root {
        --grad-start: #ff8a00; /* теплий помаранчевий */
        --grad-mid: #ff3e90;  /* рожевий відтінок */
        --grad-end: #7a00ff;  /* фіолетовий, який домінує у DRAGI */
        --card-bg: #ffffff;   /* фон карток */
        --card-shadow: rgba(0, 0, 0, 0.1);
        --text-primary: #2a0d5d; /* темно‑фіолетовий для заголовків */
        --text-secondary: #4b2c82; /* для допоміжного тексту */
        --button-bg: #ff8a00; /* основна кнопка */
        --button-bg-secondary: #7a00ff; /* вторинна кнопка */
        --button-text: #ffffff;
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      body {
        background: linear-gradient(45deg, var(--grad-start), var(--grad-mid), var(--grad-end));
        background-size: 400% 400%;
        animation: gradientShift 15s ease infinite;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
        color: var(--text-primary);
        display: flex;
        justify-content: center;
      }
      @keyframes gradientShift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
      #app {
        width: 100%;
        max-width: 480px;
        margin: 0 auto;
      }
      .screen {
        display: none;
        min-height: 100vh;
        padding: 40px 20px;
      }
      .screen.active {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
      }
      /* Спільні стилі для заголовків і тексту */
      h1, h2, h3 {
        margin-top: 0;
        margin-bottom: 0.8rem;
      }
      h1 {
        font-size: 2rem;
        font-weight: 700;
        color: #ffffff;
      }
      h2 {
        font-size: 1.6rem;
        font-weight: 700;
        color: #ffffff;
      }
      p {
        font-size: 1rem;
        line-height: 1.4;
        margin-bottom: 1rem;
      }
      /* Кнопки */
      .btn {
        background: var(--button-bg);
        color: var(--button-text);
        padding: 0.8rem 1.2rem;
        border: none;
        border-radius: 12px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.25);
        transition: transform 0.2s;
      }
      .btn:hover {
        transform: scale(1.05);
      }
      .btn-secondary {
        background: var(--button-bg-secondary);
      }
      /* Стилі для карток введення */
      .input-card {
        width: 100%;
        background: var(--card-bg);
        border-radius: 16px;
        box-shadow: 0 8px 20px var(--card-shadow);
        padding: 1.2rem;
        margin-bottom: 1rem;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        color: var(--text-primary);
      }
      .input-card .emoji {
        /* Збільшуємо емодзі для кращої візуальної ідентифікації предметів */
        font-size: 2.2rem;
        margin-bottom: 0.5rem;
      }
      .input-card label {
        font-weight: 600;
        margin-bottom: 0.4rem;
        /* Збільшимо шрифт підпису для кращої читабельності */
        font-size: 1.2rem;
      }
      .input-card input {
        width: 100%;
        background: rgba(0, 0, 0, 0.05);
        border: none;
        border-radius: 8px;
        /* Збільшуємо відступи й розмір шрифту усередині полів */
        padding: 0.8rem;
        font-size: 1.1rem;
        color: var(--text-primary);
      }
      .input-card input:focus {
        outline: none;
        box-shadow: 0 0 0 2px var(--button-bg) inset;
      }
      /* Додатковий відступ між двома полями оцінок всередині картки */
      .input-card input + input {
        margin-top: 0.6rem;
      }
      /* Видаляємо стиль для вибору Драгі (більше не використовуємо) */
      /* Контейнер для предметів та картки з балами.  
         Тепер використовуємо CSS‑сітку замість флексів, щоб картки краще вирівнювались.  
         На мобільних кожна картка займає всю ширину, а на більших екранах – дві або три колонки. */
      .subjects-container {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1rem;
        width: 100%;
        margin-bottom: 1rem;
      }
      .input-card.subject {
        width: 100%;
        /* Більше місця під два поля та підпис */
        min-height: 260px;
        padding: 1.6rem;
        /* Зберігаємо вертикальне розміщення елементів через flex зі спадкоємної .input-card */
        display: flex;
        flex-direction: column;
        align-items: flex-start;
      }
      @media (min-width: 600px) {
        .subjects-container {
          grid-template-columns: repeat(2, 1fr);
        }
      }
      @media (min-width: 900px) {
        /* На великих екранах використовується дві колонки замість трьох, щоб картки були ширші */
        .subjects-container {
          grid-template-columns: repeat(2, 1fr);
        }
      }
      /* Слайдер для вибору місяця */
      .slider-container {
        width: 100%;
        margin: 1rem 0;
      }
      .slider-container input[type="range"] {
        width: 100%;
        -webkit-appearance: none;
        height: 8px;
        border-radius: 4px;
        background: rgba(0, 0, 0, 0.1);
        outline: none;
      }
      .slider-container input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 22px;
        height: 22px;
        border-radius: 50%;
        background: var(--button-bg);
        cursor: pointer;
        box-shadow: 0 0 4px rgba(0,0,0,0.3);
      }
      .slider-container input[type="range"]::-moz-range-thumb {
        width: 22px;
        height: 22px;
        border-radius: 50%;
        background: var(--button-bg);
        cursor: pointer;
        box-shadow: 0 0 4px rgba(0,0,0,0.3);
      }
      .slider-labels {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        margin-top: 0.5rem;
      }
      .slider-labels span {
        font-size: 0.8rem;
        color: var(--text-primary);
        padding: 0.3rem 0.5rem;
        border-radius: 8px;
      }
      .slider-labels span.active {
        background: var(--button-bg);
        color: #ffffff !important;
        font-weight: 600;
      }
      .result-block {
        background: var(--card-bg);
        border-radius: 16px;
        box-shadow: 0 8px 20px var(--card-shadow);
        padding: 1.5rem;
        margin-bottom: 1rem;
        width: 100%;
        text-align: center;
        color: var(--text-primary);
      }
      .result-block img {
        width: 70%;
        max-width: 280px;
        border-radius: 16px;
        margin-bottom: 1rem;
        object-fit: cover;
      }
      .stress-bar {
        width: 100%;
        height: 8px;
        background: rgba(0, 0, 0, 0.1);
        border-radius: 4px;
        overflow: hidden;
        margin: 0.5rem 0;
      }
      .stress-fill {
        height: 100%;
        width: 0;
        background: var(--button-bg-secondary);
        transition: width 0.3s ease;
      }
      /* CTA блок */
      .cta {
        background: rgba(255, 255, 255, 0.15);
        padding: 1rem;
        border-radius: 12px;
        backdrop-filter: blur(10px);
        color: #ffffff;
        margin-top: 1rem;
        width: 100%;
      }
      .cta h3 {
        font-size: 1.2rem;
        margin-bottom: 0.5rem;
      }
      .cta p {
        font-size: 0.9rem;
        line-height: 1.4;
        margin-bottom: 0.6rem;
      }
      .store-buttons {
        display: flex;
        gap: 0.5rem;
        margin-top: 0.5rem;
      }
      .store-buttons a {
        flex: 1;
        text-decoration: none;
        background: var(--button-bg);
        color: var(--button-text);
        padding: 0.6rem 0.8rem;
        border-radius: 8px;
        font-weight: 600;
        font-size: 0.9rem;
        text-align: center;
        transition: opacity 0.2s;
      }
      .store-buttons a.play {
        background: var(--button-bg-secondary);
      }
      .store-buttons a:hover {
        opacity: 0.85;
      }
      .back-btn {
        margin-top: 1rem;
        font-size: 0.9rem;
        color: #ffffff;
        text-decoration: underline;
        cursor: pointer;
      }

      /* Перемикач (switch) для підготовки з Драгі */

      /* Додаткове перевизначення розмітки для контейнера предметів.  
         У деяких браузерах попередні стилі можуть перекриватись, тому тут використовуємо !important, щоб гарантовано  
         відображати картки у стовпчик на мобільних і по два/три на більших екранах. */
      .subjects-container {
        /* Картки розміщуються одна під одною, щоб вони були широкими та читабельними */
        display: flex !important;
        flex-direction: column !important;
        gap: 1rem;
        width: 100%;
        margin-bottom: 1rem;
      }
      .input-card.subject {
        width: 100% !important;
        /* Збільшуємо висоту карток для кращої читабельності */
        min-height: 260px;
      }
      /* Оскільки ми показуємо картки вертикально, медіа‑запити для кількості колонок більше не потрібні */
      @media (min-width: 600px) {
        .subjects-container {
          flex-direction: column !important;
        }
      }
      @media (min-width: 900px) {
        .subjects-container {
          flex-direction: column !important;
        }
      }
    </style>
  </head>
  <body>
    <div id="app">
      <!-- Стартовий екран -->
      <section id="start-screen" class="screen active">
        <img src="https://i.postimg.cc/QxNKk1Kz/with-book.png" alt="Драгі" style="width: 140px; height:auto; margin-bottom: 1rem;" />
        <h1>Коли починати готуватись до НМТ?</h1>
        <p style="color:#ffffff; max-width: 380px;">Цей інструмент допоможе визначити оптимальний час початку підготовки до НМТ залежно від твоїх стартових балів і бажаного результату. Введи свої бали — і дізнайся, коли стартувати.</p>
        <button class="btn" id="start-btn">Розпочати</button>
      </section>
      <!-- Екран введення даних -->
      <section id="input-screen" class="screen">
        <h2 style="color:#ffffff;">Вкажи свої результати</h2>
        <div class="subjects-container">
          <!-- Українська мова: стартовий та бажаний бал -->
          <div class="input-card subject">
            <span class="emoji">📘</span>
            <label>Українська мова</label>
            <input type="number" id="start-ua" min="100" max="200" placeholder="Початковий бал (100–200)" />
            <input type="number" id="target-ua" min="100" max="200" placeholder="Бажаний бал (100–200)" />
          </div>
          <!-- Математика: стартовий та бажаний бал -->
          <div class="input-card subject">
            <span class="emoji">🔢</span>
            <label>Математика</label>
            <input type="number" id="start-math" min="100" max="200" placeholder="Початковий бал (100–200)" />
            <input type="number" id="target-math" min="100" max="200" placeholder="Бажаний бал (100–200)" />
          </div>
          <!-- Історія України: стартовий та бажаний бал -->
          <div class="input-card subject">
            <span class="emoji">📜</span>
            <label>Історія України</label>
            <input type="number" id="start-hist" min="100" max="200" placeholder="Початковий бал (100–200)" />
            <input type="number" id="target-hist" min="100" max="200" placeholder="Бажаний бал (100–200)" />
          </div>
        </div>
        <button class="btn" id="calc-btn" style="margin-top:1rem; width:100%;">Далі</button>
        <span class="back-btn" id="back-to-start">← Назад</span>
      </section>
      <!-- Екран результатів -->
      <section id="result-screen" class="screen">
        <!-- Базова рекомендація -->
        <div id="base-rec" style="color:#ffffff; margin-bottom:1rem; font-size:1.1rem; font-weight:600;"></div>
        <!-- Інструкція для повзунка -->
        <p id="slider-note" style="display:none; color:#ffebe0; font-size:0.9rem; max-width:100%; margin-bottom:1rem;"></p>
        <!-- Перемикач Драгі видалено -->
        <!-- Результат та повзунок (завжди відображаються) -->
        <div class="result-block">
          <img id="mood-img" src="" alt="Настрій" />
          <p id="status-text" style="font-weight:600; margin-bottom:0.5rem;"></p>
          <p id="plan-text" style="margin-bottom:0.5rem;"></p>
          <div class="stress-bar"><div class="stress-fill" id="stress-fill"></div></div>
          <p id="stress-text" style="margin-bottom:0.5rem;"></p>
          <p id="advice-text" style="font-size:0.9rem; color: var(--text-secondary);"></p>
        </div>
        <!-- Повзунок вибору місяця та підписи -->
        <div class="slider-container" id="slider-container">
          <input type="range" id="month-slider" min="0" max="8" step="1" />
          <div class="slider-labels" id="slider-labels">
            <span>Серп.</span>
            <span>Вер.</span>
            <span>Жовт.</span>
            <span>Лист.</span>
            <span>Груд.</span>
            <span>Січ.</span>
            <span>Лют.</span>
            <span>Бер.</span>
            <span>Квіт.</span>
          </div>
        </div>
        <!-- CTA блок -->
        <div class="cta" id="cta-block">
          <h3>Завантажуй Драгі та починай👇</h3>
          <p>
            Драгі — твій особистий тренер до НМТ: короткі анімовані уроки, адаптивні вправи, зворотній звʼязок та розумний план.<br />
            Все в одному місці!<br />
            Сплануй своє навчання в застосунку та спробуй першу тему безкоштовно вже сьогодні!😇⬇️
          </p>
          <div class="store-buttons">
            <a href="https://apps.apple.com/ua/app/%D0%B4%D1%80%D0%B0%D0%B3%D1%96-%D0%BF%D1%96%D0%B4%D0%B3%D0%BE%D1%82%D0%BE%D0%B2%D0%BA%D0%B0-%D0%B4%D0%BE-%D0%BD%D0%BC%D1%82-%D0%B7%D0%BD%D0%BE/id6502047535" target="_blank">App Store</a>
            <a href="https://play.google.com/store/apps/details?id=ua.dragi.education" target="_blank" class="play">Google Play</a>
          </div>
        </div>
        <button class="btn-secondary btn" id="restart-btn" style="margin-top:1rem; width:100%;">Почати знову</button>
      </section>
    </div>
    <script>
      // Масиви базових параметрів для місяців (Серпень по Квітень)
      const months = ['Серпень','Вересень','Жовтень','Листопад','Грудень','Січень','Лютий','Березень','Квітень'];
      const baseIntensity = ['light','light','medium','medium','medium','high','high','crunch','crunch'];
      const baseStress = [1,2,2,3,4,4,5,5,5];
      const focusArray = [
        'звичка, базові теми',
        'системність, міні‑тести',
        'прогалини, пробні екзамени раз на два тижні',
        'темп + формат, тайм‑менеджмент',
        'інтенсивніше, перші пробні екзамени',
        'слабкі теми, повні пробні екзамени щотижня',
        'формат, таймінг, помилки',
        'інтенсив, максимум практики',
        'повторення, мікро‑цілі, стабілізація'
      ];
      const intensityMinutes = {
        'light': '20–30 хв на предмет; 3 дні на тиждень',
        'medium': '30–40 хв на предмет; 4–5 днів на тиждень',
        'high': '45–60 хв на предмет; 5–6 днів на тиждень + щотижневі пробні екзамени',
        'crunch': '60–75 хв на предмет; 6–7 днів на тиждень + 2 пробні екзамени/місяць та щоденний тайм‑тренінг'
      };
      const intensityNames = {
        'light': 'легкий',
        'medium': 'середній',
        'high': 'високий',
        'crunch': 'інтенсивний'
      };
      // Зображення для настроїв
      const moodImages = {
        super_happy: 'https://i.postimg.cc/tJYDYwb3/happ1.jpg',
        happy: 'https://i.postimg.cc/Ss517kDT/happ2.jpg',
        neutral: 'https://i.postimg.cc/9XRnXwQv/happ3.jpg',
        anxious: 'https://i.postimg.cc/K8Fq59D2/happ4.jpg',
        panic: 'https://i.postimg.cc/3RP909xz/happ5.jpg',
        unhappy: 'https://i.postimg.cc/D0kdwZCT/happ-6.jpg'
      };
      // Тексти для настроїв
      const moodTexts = {
        super_happy: 'Ідеальний таймінг! Малий щоденний темп дає великі результати без стресу.',
        happy: 'Гарний старт! Регулярність важливіша за інтенсивність. 20–30 хвилин щодня залишать час для відпочинку.',
        neutral: 'Скоро старт. Потрібна дисципліна та більше практики. Зменшуй прокрастинацію й стеж за прогресом.',
        anxious: 'Стислі строки. Потрібен чіткий план, щотижневі тести та контроль таймінгу.',
        panic: 'Дуже пізно. Потрібні щоденні інтенсивні тренування. Можливо варто скоригувати ціль або план.',
        unhappy: 'Радимо готуватись із Драгі, щоб отримати користь, якісно підготуватись та отримати задоволення від процесу!'
      };
      // Доступ до елементів DOM
      const startScreen = document.getElementById('start-screen');
      const inputScreen = document.getElementById('input-screen');
      const resultScreen = document.getElementById('result-screen');
      const startBtn = document.getElementById('start-btn');
      const calcBtn = document.getElementById('calc-btn');
      const restartBtn = document.getElementById('restart-btn');
      const baseRecElem = document.getElementById('base-rec');
      const sliderNoteElem = document.getElementById('slider-note');
      // Елементи для слайдера вибору місяця
      const monthSlider = document.getElementById('month-slider');
      const sliderLabels = document.getElementById('slider-labels');
      const moodImgElem = document.getElementById('mood-img');
      const statusTextElem = document.getElementById('status-text');
      const planTextElem = document.getElementById('plan-text');
      const stressFillElem = document.getElementById('stress-fill');
      const stressTextElem = document.getElementById('stress-text');
      const adviceTextElem = document.getElementById('advice-text');
      // Перемикач назад
      document.getElementById('back-to-start').onclick = () => showScreen('start');
      // Змінні для збереження даних
      let startUA = null;
      let startMath = null;
      let startHist = null;
      let targetUA = null;
      let targetMath = null;
      let targetHist = null;
      let gapBucket = 'G0';
      // Перемикач та блоки пов’язані з підготовкою з Драгі більше не використовуються.
      // Функція зміни екрану
      function showScreen(name) {
        // Приховуємо всі екрани
        [startScreen, inputScreen, resultScreen].forEach(el => el.classList.remove('active'));
      if (name === 'start') {
          startScreen.classList.add('active');
        } else if (name === 'input') {
          inputScreen.classList.add('active');
        } else if (name === 'result') {
          resultScreen.classList.add('active');
        }
      }
      // Слухач для кнопки старту
      startBtn.onclick = () => {
        showScreen('input');
      };
      // Слухач для кнопки розрахунку
      calcBtn.onclick = () => {
        // Зчитуємо значення для кожного предмета
        const sUA = parseInt(document.getElementById('start-ua').value, 10);
        const tUA = parseInt(document.getElementById('target-ua').value, 10);
        const sMath = parseInt(document.getElementById('start-math').value, 10);
        const tMath = parseInt(document.getElementById('target-math').value, 10);
        const sHist = parseInt(document.getElementById('start-hist').value, 10);
        const tHist = parseInt(document.getElementById('target-hist').value, 10);
        // Валідація полів: усі значення між 100 та 200
        if (
          isNaN(sUA) || sUA < 100 || sUA > 200 ||
          isNaN(tUA) || tUA < 100 || tUA > 200 ||
          isNaN(sMath) || sMath < 100 || sMath > 200 ||
          isNaN(tMath) || tMath < 100 || tMath > 200 ||
          isNaN(sHist) || sHist < 100 || sHist > 200 ||
          isNaN(tHist) || tHist < 100 || tHist > 200
        ) {
          alert('Будь ласка, заповни всі поля балами від 100 до 200.');
          return;
        }
        // Зберігаємо дані
        startUA = sUA;
        targetUA = tUA;
        startMath = sMath;
        targetMath = tMath;
        startHist = sHist;
        targetHist = tHist;
        // Розраховуємо різниці для кожного предмета
        const diffUA = targetUA - startUA;
        const diffMath = targetMath - startMath;
        const diffHist = targetHist - startHist;
        const avgDiff = Math.round((diffUA + diffMath + diffHist) / 3);
        // Визначаємо bucket за середнім розривом
        gapBucket = computeGapBucket(avgDiff);
        // Виводимо базову рекомендацію із префіксом
        baseRecElem.textContent = getBaseRecommendation(gapBucket);
        // Показуємо нотатку про повзунок (вона відображатиметься після увімкнення Драгі)
        sliderNoteElem.innerHTML = '<strong>Оранжева крапка — це твій початок підготовки.</strong> Спробуй пересунути повзунок ліворуч/праворуч і зрозумієш, як буде відчуватись відкладати, або почати підготовку раніше😇';
        renderResult();
        showScreen('result');
      };

      // Слухач для зміни значення на повзунку місяців
      if (monthSlider) {
        monthSlider.addEventListener('input', () => {
          const idx = parseInt(monthSlider.value);
          updateResult(idx);
          updateSliderHighlight(idx);
        });
      }

      // Перемикач підготовки з Драгі видалено, тому немає слухача
      // Розрахунок категорії розриву
      function computeGapBucket(gap) {
        if (gap >= 50) return 'G3';
        if (gap >= 20) return 'G2';
        if (gap >= 1) return 'G1';
        return 'G0';
      }
      // Базові рекомендації перед вибором місяця
      function getBaseRecommendation(bucket) {
        const prefix = '❗️Рекомендація (врахував твої бали): ';
        if (bucket === 'G3') {
          return prefix + 'Щоб досягти своєї цілі й покращити результат на 50+ балів, починай вже в серпні. Ранній старт дасть час закласти базу та зменшити стрес.';
        } else if (bucket === 'G2') {
          return prefix + 'Щоб покращити результат на 20–50 балів, радимо починати у вересні та вчитись регулярно: 20–30 хвилин на предмет щодня.';
        } else if (bucket === 'G1') {
          return prefix + 'Якщо потрібно до 20 балів, можеш стартувати у грудні–лютому. Але обов’язково тренуй формат НМТ та таймінг.';
        } else {
          return prefix + 'Ти вже майже біля своєї цілі! Підтримуй форму, тренуй таймінг і тренуйся на пробних екзаменах.';
        }
      }
      // Розрахунок плану за місяцем та категорією розриву
      function computePlan(monthIndex, bucket) {
        let intensity = baseIntensity[monthIndex];
        let stress = baseStress[monthIndex];
        const intensityOrder = ['light','medium','high','crunch'];
        function upgrade(curr) {
          const idx = intensityOrder.indexOf(curr);
          return intensityOrder[Math.min(idx + 1, intensityOrder.length - 1)];
        }
        function maxIntensity(curr, max) {
          const idx = intensityOrder.indexOf(curr);
          const maxIdx = intensityOrder.indexOf(max);
          return intensityOrder[Math.min(idx, maxIdx)];
        }
        // У квітні завжди найвищий рівень
        if (monthIndex === 8) {
          intensity = 'crunch';
          stress = 5;
        } else {
          if (bucket === 'G3') {
            if (monthIndex >= 5) {
              // Старт після грудня: максимальний режим
              if (monthIndex >= 6) {
                intensity = 'crunch';
              } else {
                intensity = 'high';
              }
              stress = 5;
            } else {
              intensity = upgrade(intensity);
              stress = Math.min(stress + 1, 5);
            }
          } else if (bucket === 'G2') {
            if (monthIndex >= 3) {
              intensity = upgrade(intensity);
              stress = Math.min(stress + 1, 5);
            }
          } else if (bucket === 'G1') {
            if (monthIndex >= 6) {
              intensity = maxIntensity('high', 'high');
              stress = Math.min(stress, 4);
            }
          } else {
            intensity = 'light';
            stress = 1;
          }
        }
        const focus = focusArray[monthIndex];
        return { intensity, stress, focus };
      }
      // Розрахунок настрою за місяцем та bucket
      function computeMood(monthIndex, bucket) {
        // Якщо квітень (8-й індекс), завжди паніка
        if (monthIndex === 8) {
          return 'panic';
        }
        if (monthIndex <= 1) {
          if (bucket === 'G3') return 'happy';
          if (bucket === 'G2') return 'super_happy';
          return 'super_happy';
        } else if (monthIndex <= 3) {
          if (bucket === 'G3') return 'neutral';
          if (bucket === 'G2') return 'happy';
          return 'super_happy';
        } else if (monthIndex <= 5) {
          if (bucket === 'G3') return 'anxious';
          if (bucket === 'G2') return 'neutral';
          return 'happy';
        } else {
          if (bucket === 'G3') return 'panic';
          if (bucket === 'G2') return 'anxious';
          if (bucket === 'G1') return 'neutral';
          return 'happy';
        }
      }
      // Відображення результату для конкретного місяця
      function updateResult(monthIndex) {
        const plan = computePlan(monthIndex, gapBucket);
        const mood = computeMood(monthIndex, gapBucket);
        // Зображення та текст настрою
        moodImgElem.src = moodImages[mood];
        statusTextElem.textContent = moodTexts[mood];
        // Деталі плану
        planTextElem.textContent = `Темп: ${intensityNames[plan.intensity]} — ${intensityMinutes[plan.intensity]}; фокус: ${plan.focus}.`;
        // Рівень стресу з описом
        let stressDesc = '';
        if (plan.stress <= 1) stressDesc = 'низький';
        else if (plan.stress === 2) stressDesc = 'помірний';
        else if (plan.stress === 3) stressDesc = 'середній';
        else if (plan.stress === 4) stressDesc = 'високий';
        else stressDesc = 'дуже високий: не встигнеш пройти всю програму';
        stressTextElem.textContent = `Рівень стресу: ${plan.stress}/5 — ${stressDesc}`;
        // Заповнення смуги стресу
        const width = (plan.stress / 5) * 100;
        stressFillElem.style.width = width + '%';
        // Порада
        adviceTextElem.textContent = getAdvice(plan.intensity);
      }

      // Підсвічуємо активний підпис місяця на шкалі
      function updateSliderHighlight(idx) {
        const spans = sliderLabels.querySelectorAll('span');
        spans.forEach((span, i) => {
          if (i === idx) span.classList.add('active');
          else span.classList.remove('active');
        });
      }
      // Мікро‑поради за інтенсивністю
      function getAdvice(intensity) {
        switch (intensity) {
          case 'light':
            return 'Будуй звичку: 3 дні на тиждень по 20–30 хв. Темп спокійний, вистачить часу на прогулянки з друзями та другою половинкою.';
          case 'medium':
            return 'Поступовий темп: 4–5 днів на тиждень по 30–40 хвилин. Додавай практику, але ще можеш відпочивати.';
          case 'high':
            return 'Серйозний темп: 5–6 днів на тиждень по 45–60 хвилин та щотижневі пробні екзамени. Часу на розваги майже немає, слідкуй за балансом, щоб уникнути стресу.';
          case 'crunch':
            return 'Максимальний темп: 6–7 днів на тиждень по 60–75 хвилин та 2 пробні екзамени на місяць. Дуже мало вільного часу та високий ризик не встигнути пройти всю програму.';
          default:
            return '';
        }
      }
      // Основна функція відображення результату
      function renderResult() {
        // Нотатка про повзунок завжди відображається, щоб пояснити користувачу, як ним користуватись.
        sliderNoteElem.style.display = 'block';
        // Вибір місяця за замовчуванням: для G3 -> Серп.; G2 -> Вер.; G1 -> Груд./Січ./Лют.; G0 -> Лют.
        let defaultIndex = 0;
        if (gapBucket === 'G3') defaultIndex = 0;
        else if (gapBucket === 'G2') defaultIndex = 1;
        else if (gapBucket === 'G1') {
          const avgDiff = ( (targetUA - startUA) + (targetMath - startMath) + (targetHist - startHist) ) / 3;
          if (avgDiff >= 15) defaultIndex = 4; // грудень
          else if (avgDiff >= 8) defaultIndex = 5; // січень
          else defaultIndex = 6; // лютий
        } else {
          defaultIndex = 6;
        }
        // Встановити значення повзунка та виділити підпис
        monthSlider.value = defaultIndex;
        updateSliderHighlight(defaultIndex);
        updateResult(defaultIndex);
      }
      // Кнопка почати знову
      restartBtn.onclick = () => {
        // Скидаємо всі значення
        document.getElementById('start-ua').value = '';
        document.getElementById('target-ua').value = '';
        document.getElementById('start-math').value = '';
        document.getElementById('target-math').value = '';
        document.getElementById('start-hist').value = '';
        document.getElementById('target-hist').value = '';
        // Скидаємо повзунок та підсвічування
        if (monthSlider) {
          monthSlider.value = 0;
          updateSliderHighlight(0);
        }
        // Очищаємо рекомендацію та нотатку
        baseRecElem.textContent = '';
        sliderNoteElem.style.display = 'none';
        // Повертаємось на стартовий екран
        showScreen('start');
      };
    </script>
  </body>
</html>